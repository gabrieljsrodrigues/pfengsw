{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useFormik}from'formik';import*as Yup from'yup';import{TextField,Button,Paper,Typography,Grid}from'@mui/material';import{useNavigate}from'react-router-dom';// Importa as funções de API do seu api.js\n// Ajuste o caminho relativo se o seu api.js estiver em outro lugar\nimport{fetchOpportunities,submitApplication}from'../../services/api';// Validação do formulário\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const validationSchema=Yup.object({fullName:Yup.string().required('Obrigatório'),birthDate:Yup.date().required('Obrigatório'),cpf:Yup.string().matches(/^\\d{3}\\.\\d{3}\\.\\d{3}-\\d{2}$/,'CPF inválido'),motivation:Yup.string().required('Explique sua motivação')});// REMOVEMOS AS FUNÇÕES consultar_oportunidades e salvarInscricao DAQUI,\n// POIS USAREMOS AS VERSÕES DO api.js DIRETAMENTE NO COMPONENTE\n// Componente principal\nexport default function SubscriptionForm(){const[oportunidadeId,setOportunidadeId]=useState(null);const navigate=useNavigate();useEffect(()=>{// Usa a função fetchOpportunities do api.js\nfetchOpportunities().then(response=>{const oportunidades=response.data;// Axios retorna os dados em .data\nif(oportunidades&&oportunidades.length>0){setOportunidadeId(oportunidades[0].id);}else{console.warn('Nenhuma oportunidade encontrada.');}}).catch(error=>{// Captura erros da requisição GET\nconsole.error('Erro ao carregar oportunidades:',error.response?error.response.data:error.message);});},[]);const formik=useFormik({initialValues:{fullName:'',birthDate:'',cpf:'',motivation:''},validationSchema,onSubmit:async values=>{if(!oportunidadeId){alert(\"Nenhuma oportunidade disponível para inscrição.\");return;}const dadosInscricao={nome:values.fullName,nascimento:values.birthDate,cpf:values.cpf,mensagem:values.motivation,oportunidade_id:oportunidadeId};try{// Usa a função submitApplication do api.js\nconst response=await submitApplication(dadosInscricao);// O backend retorna {\"success\": true} para esta rota\nif(response.data&&response.data.success){alert(\"Inscrição enviada com sucesso!\");navigate('/volunteer');// Ajuste a rota se necessário\n}else{alert(\"Erro ao enviar inscrição: Sucesso não confirmado pelo backend.\");console.error('Sucesso não confirmado pelo backend:',response.data);}}catch(error){// Captura erros da requisição POST\nlet errorMessage=\"Erro ao enviar inscrição.\";if(error.response){errorMessage+=\" Detalhes: \".concat(error.response.data.detail||error.response.data.error||error.message);}else{errorMessage+=\" Detalhes: \".concat(error.message);}alert(errorMessage);console.error('Erro ao enviar inscrição:',error);}}});return/*#__PURE__*/_jsxs(Paper,{sx:{p:3,maxWidth:600,margin:'20px auto'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,children:\"Candidatura\"}),/*#__PURE__*/_jsx(\"form\",{onSubmit:formik.handleSubmit,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Nome Completo\",name:\"fullName\",value:formik.values.fullName,onChange:formik.handleChange,error:formik.touched.fullName&&Boolean(formik.errors.fullName),helperText:formik.touched.fullName&&formik.errors.fullName})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Data de Nascimento\",type:\"date\",InputLabelProps:{shrink:true},name:\"birthDate\",value:formik.values.birthDate,onChange:formik.handleChange})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"CPF\",name:\"cpf\",placeholder:\"000.000.000-00\",value:formik.values.cpf,onChange:formik.handleChange,error:formik.touched.cpf&&Boolean(formik.errors.cpf),helperText:formik.touched.cpf&&formik.errors.cpf})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,multiline:true,rows:4,label:\"Motiva\\xE7\\xE3o\",name:\"motivation\",value:formik.values.motivation,onChange:formik.handleChange,error:formik.touched.motivation&&Boolean(formik.errors.motivation),helperText:formik.touched.motivation&&formik.errors.motivation})}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",color:\"primary\",disabled:formik.isSubmitting||!oportunidadeId// Adicione formik.isSubmitting para desabilitar enquanto envia\n,children:\"Enviar Candidatura\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",sx:{ml:2},children:\"Cancelar\"})]})]})})]});}","map":{"version":3,"names":["React","useEffect","useState","useFormik","Yup","TextField","Button","Paper","Typography","Grid","useNavigate","fetchOpportunities","submitApplication","jsx","_jsx","jsxs","_jsxs","validationSchema","object","fullName","string","required","birthDate","date","cpf","matches","motivation","SubscriptionForm","oportunidadeId","setOportunidadeId","navigate","then","response","oportunidades","data","length","id","console","warn","catch","error","message","formik","initialValues","onSubmit","values","alert","dadosInscricao","nome","nascimento","mensagem","oportunidade_id","success","errorMessage","concat","detail","sx","p","maxWidth","margin","children","variant","gutterBottom","handleSubmit","container","spacing","item","xs","fullWidth","label","name","value","onChange","handleChange","touched","Boolean","errors","helperText","type","InputLabelProps","shrink","placeholder","multiline","rows","color","disabled","isSubmitting","ml"],"sources":["/workspaces/pfengsw/tempo-bem-gasto-main/frontend/src/views/Volunteer/SubscriptionForm.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useFormik } from 'formik';\nimport * as Yup from 'yup';\nimport {\n    TextField,\n    Button,\n    Paper,\n    Typography,\n    Grid,\n} from '@mui/material';\nimport { useNavigate } from 'react-router-dom';\n\n// Importa as funções de API do seu api.js\n// Ajuste o caminho relativo se o seu api.js estiver em outro lugar\nimport { fetchOpportunities, submitApplication } from '../../services/api'; \n\n// Validação do formulário\nconst validationSchema = Yup.object({\n    fullName: Yup.string().required('Obrigatório'),\n    birthDate: Yup.date().required('Obrigatório'),\n    cpf: Yup.string().matches(/^\\d{3}\\.\\d{3}\\.\\d{3}-\\d{2}$/, 'CPF inválido'),\n    motivation: Yup.string().required('Explique sua motivação')\n});\n\n// REMOVEMOS AS FUNÇÕES consultar_oportunidades e salvarInscricao DAQUI,\n// POIS USAREMOS AS VERSÕES DO api.js DIRETAMENTE NO COMPONENTE\n\n// Componente principal\nexport default function SubscriptionForm() {\n    const [oportunidadeId, setOportunidadeId] = useState(null);\n    const navigate = useNavigate();\n\n    useEffect(() => {\n        // Usa a função fetchOpportunities do api.js\n        fetchOpportunities().then(response => {\n            const oportunidades = response.data; // Axios retorna os dados em .data\n            if (oportunidades && oportunidades.length > 0) {\n                setOportunidadeId(oportunidades[0].id);\n            } else {\n                console.warn('Nenhuma oportunidade encontrada.');\n            }\n        }).catch(error => { // Captura erros da requisição GET\n            console.error('Erro ao carregar oportunidades:', error.response ? error.response.data : error.message);\n        });\n    }, []);\n\n    const formik = useFormik({\n        initialValues: {\n            fullName: '',\n            birthDate: '',\n            cpf: '',\n            motivation: ''\n        },\n        validationSchema,\n        onSubmit: async (values) => {\n            if (!oportunidadeId) {\n                alert(\"Nenhuma oportunidade disponível para inscrição.\");\n                return;\n            }\n\n            const dadosInscricao = {\n                nome: values.fullName,\n                nascimento: values.birthDate,\n                cpf: values.cpf,\n                mensagem: values.motivation,\n                oportunidade_id: oportunidadeId\n            };\n\n            try {\n                // Usa a função submitApplication do api.js\n                const response = await submitApplication(dadosInscricao); \n                // O backend retorna {\"success\": true} para esta rota\n                if (response.data && response.data.success) {\n                    alert(\"Inscrição enviada com sucesso!\");\n                    navigate('/volunteer'); // Ajuste a rota se necessário\n                } else {\n                    alert(\"Erro ao enviar inscrição: Sucesso não confirmado pelo backend.\");\n                    console.error('Sucesso não confirmado pelo backend:', response.data);\n                }\n            } catch (error) { // Captura erros da requisição POST\n                let errorMessage = \"Erro ao enviar inscrição.\";\n                if (error.response) {\n                    errorMessage += ` Detalhes: ${error.response.data.detail || error.response.data.error || error.message}`;\n                } else {\n                    errorMessage += ` Detalhes: ${error.message}`;\n                }\n                alert(errorMessage);\n                console.error('Erro ao enviar inscrição:', error);\n            }\n        }\n    });\n\n    return (\n        <Paper sx={{ p: 3, maxWidth: 600, margin: '20px auto' }}>\n            <Typography variant=\"h4\" gutterBottom>Candidatura</Typography>\n\n            <form onSubmit={formik.handleSubmit}>\n                <Grid container spacing={2}>\n                    <Grid item xs={12}>\n                        <TextField\n                            fullWidth\n                            label=\"Nome Completo\"\n                            name=\"fullName\"\n                            value={formik.values.fullName}\n                            onChange={formik.handleChange}\n                            error={formik.touched.fullName && Boolean(formik.errors.fullName)}\n                            helperText={formik.touched.fullName && formik.errors.fullName}\n                        />\n                    </Grid>\n\n                    <Grid item xs={6}>\n                        <TextField\n                            fullWidth\n                            label=\"Data de Nascimento\"\n                            type=\"date\"\n                            InputLabelProps={{ shrink: true }}\n                            name=\"birthDate\"\n                            value={formik.values.birthDate}\n                            onChange={formik.handleChange}\n                        />\n                    </Grid>\n\n                    <Grid item xs={6}>\n                        <TextField\n                            fullWidth\n                            label=\"CPF\"\n                            name=\"cpf\"\n                            placeholder=\"000.000.000-00\"\n                            value={formik.values.cpf}\n                            onChange={formik.handleChange}\n                            error={formik.touched.cpf && Boolean(formik.errors.cpf)}\n                            helperText={formik.touched.cpf && formik.errors.cpf}\n                        />\n                    </Grid>\n\n                    <Grid item xs={12}>\n                        <TextField\n                            fullWidth\n                            multiline\n                            rows={4}\n                            label=\"Motivação\"\n                            name=\"motivation\"\n                            value={formik.values.motivation}\n                            onChange={formik.handleChange}\n                            error={formik.touched.motivation && Boolean(formik.errors.motivation)}\n                            helperText={formik.touched.motivation && formik.errors.motivation}\n                        />\n                    </Grid>\n\n                    <Grid item xs={12}>\n                        <Button\n                            type=\"submit\"\n                            variant=\"contained\"\n                            color=\"primary\"\n                            disabled={formik.isSubmitting || !oportunidadeId} // Adicione formik.isSubmitting para desabilitar enquanto envia\n                        >\n                            Enviar Candidatura\n                        </Button>\n                        <Button variant=\"outlined\" sx={{ ml: 2 }}>Cancelar</Button>\n                    </Grid>\n                </Grid>\n            </form>\n        </Paper>\n    );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}